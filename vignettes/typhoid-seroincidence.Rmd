---
title: "Typhoid Seroincidence"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Typhoid Seroincidence}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
#Introduction

This vignette provides users with an example analysis using the *serocalculator* package. Users will be able to determine the seroincidence of typhoid fever in the sample population using existing longitudinal antibody dynamics from ______, and a cross-sectional serosurvey from _____. 

##References


```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
#Sample Analysis
## ##Load serocalculator package
##Still in development as of 08/11/23

```{r setup}

#library(devtools)
#install_github("UCD-SERG/serocalculator")
library(serocalculator)
library(tidyverse)
```

##Load longitudinal parameter mcmc data and prepare for model
```{r longdata}
c.hlye.IgG <- readRDS("dmcmc_hlyeigg_09.30.rds") %>%
  mutate(alpha = alpha*365.25, 
         d = r-1) %>%
  select(y1, alpha, d) 
```

##Load simulated data (lambda = .2) and prepare for model
``` {r simdata}
p.hlye.IgG  <- read_csv("simpophlyeigg.2.csv") %>%
  rename(y= y.smpl,
         a = a.smpl) %>% 
  select(y, a)
```


## Conditions based on how i simulated the data

``` {r conditions}
cond.hlye.IgG <- data.frame(nu = 1.027239,             # B noise
                            eps = 0.2,            # M noise
                            y.low = 0.0,          # low cutoff
                            y.high = 5e4); 
```


## Seroincidence estimation
```{r seroinc}
start <- .05

lambda = start # initial estimate: starting value
log.lambda = log(lambda)
log.lmin=log(lambda/10)
log.lmax=log(10*lambda) 



objfunc <- function(llam){
  return(res <- fdev(llam, p.hlye.IgG, c.hlye.IgG, cond.hlye.IgG))
}


fit <- nlm(objfunc,log.lambda,
           hessian=TRUE,print.level=0,stepmax=(log.lmax-log.lmin)/4)


#lambda, lower, upper, LF min
log.lambda.est <- c(exp(fit$estimate),
                    exp(fit$estimate + qnorm(c(0.025))*sqrt(1/fit$hessian)),
                    exp(fit$estimate + qnorm(c(0.975))*sqrt(1/fit$hessian)),
                    fit$minimum)


log.lambda.est
```
